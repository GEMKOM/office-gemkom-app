<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validation Manager Test</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="create.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>Validation Manager Test</h2>
        
        <div class="row">
            <div class="col-md-6">
                <h4>Form Fields</h4>
                <div class="mb-3">
                    <label for="request-title" class="form-label">Talep Başlığı <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="request-title" placeholder="Talep başlığını girin">
                </div>
                
                <div class="mb-3">
                    <label for="request-description" class="form-label">Talep Açıklaması</label>
                    <textarea class="form-control" id="request-description" rows="3" placeholder="Talep açıklamasını girin"></textarea>
                </div>
                
                <button class="btn btn-primary" onclick="testValidation()">Test Validation</button>
                <button class="btn btn-secondary" onclick="clearValidation()">Clear Validation</button>
            </div>
            
            <div class="col-md-6">
                <h4>Test Results</h4>
                <div id="test-results"></div>
            </div>
        </div>
    </div>

    <script type="module">
        import { ValidationManager } from './validationManager.js';
        
        // Initialize validation manager
        window.validationManager = new ValidationManager();
        window.validationManager.setupAllFieldValidations();
        
        // Test data
        window.testData = {
            items: [
                { code: '', name: 'Test Item 1', job_no: '', quantity: 0, unit: 'adet' },
                { code: 'ITEM001', name: '', job_no: 'JOB001', quantity: 5, unit: 'adet' }
            ],
            suppliers: [
                { id: 1, name: '' },
                { id: 2, name: 'Supplier 2' }
            ],
            offers: {
                1: { 0: { totalPrice: 0 }, 1: { totalPrice: 100 } },
                2: { 0: { totalPrice: 0 }, 1: { totalPrice: 0 } }
            },
            itemRecommendations: {
                0: null,
                1: 1
            }
        };
        
        window.testValidation = function() {
            const formData = {
                'request-title': document.getElementById('request-title').value,
                'request-description': document.getElementById('request-description').value
            };
            
            const validation = window.validationManager.validateAllData(
                formData,
                window.testData.items,
                window.testData.suppliers,
                window.testData.itemRecommendations,
                window.testData.offers
            );
            
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = `
                <div class="alert alert-${validation.isValid ? 'success' : 'danger'}">
                    <h5>Validation Result: ${validation.isValid ? 'PASSED' : 'FAILED'}</h5>
                    <p><strong>Total Errors:</strong> ${validation.errors.length}</p>
                    ${validation.errors.length > 0 ? `
                        <h6>Errors:</h6>
                        <ul>
                            ${validation.errors.map(error => `<li>${error}</li>`).join('')}
                        </ul>
                    ` : ''}
                </div>
            `;
            
            // Show field validations
            window.validationManager.showAllFieldValidations(formData);
            
            console.log('Validation result:', validation);
        };
        
        window.clearValidation = function() {
            window.validationManager.clearAllFieldValidations();
            document.getElementById('test-results').innerHTML = '';
        };
    </script>
</body>
</html>
