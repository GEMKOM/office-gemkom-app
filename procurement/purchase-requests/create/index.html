<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GEMKOM - Talep Oluştur</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../../../style.css">
    <link rel="stylesheet" href="../../../components/navbar.css">
    <link rel="icon" type="image/png" href="../../../images/gemkom.png">
    <link rel="stylesheet" href="../../../pre-auth.css">
    <link rel="stylesheet" href="create.css">
    <link rel="stylesheet" href="../../../components/header/header.css">
</head>
<body class="pre-auth">
    <!-- Navigation -->
    <div id="navbar-container"></div>

    <!-- Floating Elements -->
    <div class="floating-element"></div>
    <div class="floating-element"></div>
    <div class="floating-element"></div>

    <!-- Header Section -->
    <section class="modules-section py-5">
        <div class="container-fluid">
            <!-- Header Component -->
            <div id="header-placeholder"></div>

            <!-- Purchase Request Details Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Talep Detayları</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="request-title" class="form-label">Talep Başlığı <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="request-title" placeholder="Talep başlığını girin" required>
                                </div>
                                <div class="col-md-6">
                                    <label for="request-priority" class="form-label">Öncelik</label>
                                    <select class="form-select" id="request-priority">
                                        <option value="normal" selected>Normal</option>
                                        <option value="urgent">Acil</option>
                                        <option value="critical">Kritik</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3">
                                <div class="col-12">
                                    <label for="request-description" class="form-label">Talep Açıklaması</label>
                                    <textarea class="form-control" id="request-description" rows="3" placeholder="Talep açıklamasını girin"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Items Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-boxes me-2"></i>Malzeme Listesi</h5>
                            <div class="btn-group">
                                <button class="btn btn-outline-primary btn-sm" id="bulk-import-btn">
                                    <i class="fas fa-upload me-1"></i>Toplu İçe Aktar
                                </button>
                                <button class="btn btn-primary btn-sm" id="add-item-btn">
                                    <i class="fas fa-plus me-1"></i>Malzeme Ekle
                                </button>
                                <button class="btn btn-outline-success btn-sm" id="merge-items-btn">
                                    <i class="fas fa-object-group me-1"></i>Birleştir
                                </button>
                                <button class="btn btn-outline-danger btn-sm" id="clear-items-btn">
                                    <i class="fas fa-trash me-1"></i>Tüm Malzemeleri Sil
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- Inline editing instruction -->
                            <div class="alert alert-info alert-sm mb-3">
                                <i class="fas fa-info-circle me-2"></i>
                                <strong>İpucu:</strong> Malzeme bilgilerini düzenlemek için hücrelere tıklayabilirsiniz. 
                                <span class="text-muted">(Hücrelerin üzerine geldiğinizde düzenlenebilir olduğunu göreceksiniz)</span>
                            </div>
                            <div class="table-responsive">
                                <table class="table table-hover" id="items-table">
                                    <thead class="table-dark">
                                        <tr>
                                            <th>#</th>
                                            <th>Malzeme Kodu</th>
                                            <th>Malzeme Adı</th>
                                            <th>İş No</th>
                                            <th>Miktar</th>
                                            <th>Birim</th>
                                            <th>Öncelik</th>
                                            <th>Teknik Özellikler</th>
                                            <th>İşlemler</th>
                                        </tr>
                                    </thead>
                                    <tbody id="items-tbody">
                                        <!-- Items will be added here dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Suppliers Section -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-handshake me-2"></i>Tedarikçi Teklifleri</h5>
                            <div class="btn-group">
                                <button class="btn btn-primary btn-sm" id="add-supplier-btn">
                                    <i class="fas fa-plus me-1"></i>Tedarikçi Ekle
                                </button>
                                <button class="btn btn-outline-danger btn-sm" id="clear-suppliers-btn">
                                    <i class="fas fa-trash me-1"></i>Tüm Tedarikçileri Sil
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div id="suppliers-container">
                                <!-- Supplier cards will be added here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Comparison Table -->
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Teklif Karşılaştırma Tablosu</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered" id="comparison-table">
                                    <thead class="table-primary">
                                        <tr>
                                            <th rowspan="2" class="align-middle">Malzeme</th>
                                            <th rowspan="2" class="align-middle">İş No</th>
                                            <th rowspan="2" class="align-middle">Miktar</th>
                                            <th rowspan="2" class="align-middle">Birim</th>
                                            <th id="supplier-group-header" colspan="1" class="text-center">Tedarikçi Teklifleri</th>
                                        </tr>
                                        <tr id="supplier-headers">
                                            <!-- Supplier headers will be added here -->
                                        </tr>
                                    </thead>
                                    <tbody id="comparison-tbody">
                                        <!-- Comparison rows will be added here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Summary Section -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="mb-0"><i class="fas fa-calculator me-2"></i>Özet Bilgiler</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="summary-item">
                                        <label class="form-label">Toplam Malzeme Sayısı</label>
                                        <div class="form-control-plaintext" id="total-items">0</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="summary-item">
                                        <label class="form-label">Toplam Miktar</label>
                                        <div class="form-control-plaintext" id="total-quantity">-</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="summary-item">
                                        <label class="form-label">Önerilen Tedarikçi Sayısı</label>
                                        <div class="form-control-plaintext" id="total-suppliers">0</div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="summary-item">
                                        <label class="form-label">Toplam Tahmini Tutar (EUR)</label>
                                        <div class="form-control-plaintext" id="total-amount">€0.00</div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Item Modal -->
    <div class="modal fade" id="itemModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="itemModalTitle">Malzeme Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="itemForm">
                        <div class="row">
                            <div class="col-md-4">
                                <label class="form-label">Malzeme Kodu</label>
                                <input type="text" class="form-control" id="item-code" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Malzeme Adı</label>
                                <input type="text" class="form-control" id="item-name" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">İş No</label>
                                <input type="text" class="form-control" id="item-job-no" placeholder="SRM. KODU">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <label class="form-label">Miktar</label>
                                <input type="number" class="form-control" id="item-quantity" step="0.01" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Birim</label>
                                <select class="form-select" id="item-unit" required>
                                    <option value="">Birim Seçin</option>
                                    <option value="adet">Adet</option>
                                    <option value="kg">KG</option>
                                    <option value="metre">Metre</option>
                                    <option value="litre">Litre</option>
                                    <option value="paket">Paket</option>
                                    <option value="kutu">Kutu</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Öncelik</label>
                                <select class="form-select" id="item-priority">
                                    <option value="normal">Normal</option>
                                    <option value="acil">Acil</option>
                                    <option value="kritik">Kritik</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-12">
                                <label class="form-label">Teknik Özellikler</label>
                                <textarea class="form-control" id="item-specs" rows="3" placeholder="Teknik özellikleri buraya yazın..."></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="save-item-btn">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Import Modal -->
    <div class="modal fade" id="bulkImportModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Toplu Malzeme İçe Aktarma</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Kullanım:</strong> Excel dosyanızı yükleyin. Sistem otomatik olarak sütunları algılamaya çalışacaktır. 
                        Eğer algılanamazsa, sütunları manuel olarak eşleştirmeniz istenecektir.
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label class="form-label">Gerekli Sütunlar:</label>
                            <div class="form-control-plaintext small bg-light">
                                <code>Stok kodu - Malzeme kodu<br>
                                Ad - Malzeme adı<br>
                                SRM. KODU - İş No<br>
                                Miktar - Miktar değeri<br>
                                Birim - Birim türü</code>
                            </div>
                            <label class="form-label mt-2">Opsiyonel Sütunlar:</label>
                            <div class="form-control-plaintext small bg-light">
                                <code>Öncelik - Öncelik seviyesi<br>
                                Özellikler - Teknik özellikler</code>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Birim Seçenekleri:</label>
                            <div class="form-control-plaintext small">
                                adet, kg, metre, litre, paket, kutu
                            </div>
                            <label class="form-label mt-2">Öncelik Seçenekleri:</label>
                            <div class="form-control-plaintext small">
                                normal, acil, kritik
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Excel Dosyası Seçin:</label>
                        <input type="file" class="form-control" id="excel-file-input" 
                               accept=".xlsx,.xls,.csv" placeholder="Excel veya CSV dosyası seçin...">
                        <div class="form-text">Desteklenen formatlar: .xlsx, .xls, .csv</div>
                    </div>
                    
                    <div class="mb-3">
                        <button type="button" class="btn btn-outline-primary btn-sm" id="preview-import-btn">
                            <i class="fas fa-eye me-1"></i>Önizleme
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-sm" id="clear-import-btn">
                            <i class="fas fa-trash me-1"></i>Temizle
                        </button>
                    </div>
                    
                    <div id="import-errors" style="display: none;">
                        <!-- Error messages will be displayed here -->
                    </div>
                    
                    <div id="import-preview" style="display: none;">
                        <h6>Önizleme:</h6>
                        <div class="table-responsive">
                            <table class="table table-sm table-bordered" id="preview-table">
                                <thead class="table-light">
                                    <tr>
                                        <th>#</th>
                                        <th>Malzeme Kodu</th>
                                        <th>Malzeme Adı</th>
                                        <th>İş No</th>
                                        <th>Miktar</th>
                                        <th>Birim</th>
                                        <th>Öncelik</th>
                                        <th>Teknik Özellikler</th>
                                        <th>Durum</th>
                                    </tr>
                                </thead>
                                <tbody id="preview-tbody">
                                    <!-- Preview rows will be added here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="import-items-btn" disabled>
                        <i class="fas fa-upload me-1"></i>Malzemeleri İçe Aktar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Column Mapping Modal -->
    <div class="modal fade" id="columnMappingModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sütun Eşleştirme</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Dikkat:</strong> Excel dosyanızdaki sütunları sistem alanlarıyla eşleştirmeniz gerekiyor. 
                        Gerekli alanlar <span class="text-danger">*</span> ile işaretlenmiştir.
                    </div>
                    
                    <div id="column-mapping-container">
                        <!-- Column mapping fields will be added here dynamically -->
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="confirm-mapping-btn">
                        <i class="fas fa-check me-1"></i>Eşleştirmeyi Onayla
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Supplier Modal -->
    <div class="modal fade" id="supplierModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="supplierModalTitle">Tedarikçi Ekle</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="supplierForm">
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">Tedarikçi Adı</label>
                                <input type="text" class="form-control" id="supplier-name" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">İletişim Kişisi</label>
                                <input type="text" class="form-control" id="supplier-contact">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Telefon</label>
                                <input type="tel" class="form-control" id="supplier-phone">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">E-posta</label>
                                <input type="email" class="form-control" id="supplier-email">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-6">
                                <label class="form-label">Varsayılan Para Birimi</label>
                                <select class="form-select" id="supplier-currency">
                                    <option value="TRY">Türk Lirası (₺)</option>
                                    <option value="USD">Amerikan Doları ($)</option>
                                    <option value="EUR">Euro (€)</option>
                                    <option value="GBP">İngiliz Sterlini (£)</option>
                                </select>
                            </div>

                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="save-supplier-btn">Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Offer Modal -->
    <div class="modal fade" id="offerModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="offerModalTitle">Teklif Girişi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Tedarikçi:</strong> <span id="offer-supplier-name"></span>
                        </div>
                        <div class="col-md-6">
                            <strong>Para Birimi:</strong> <span id="offer-currency"></span>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered" id="offer-table">
                            <thead class="table-light">
                                <tr>
                                    <th>Malzeme</th>
                                    <th>İş No</th>
                                    <th>Miktar</th>
                                    <th>Birim</th>
                                    <th>Birim Fiyat</th>
                                    <th>Teslimat Süresi</th>
                                    <th>Notlar</th>
                                    <th>Toplam Fiyat</th>
                                </tr>
                            </thead>
                            <tbody id="offer-tbody">
                                <!-- Offer items will be added here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                    <button type="button" class="btn btn-primary" id="save-offer-btn">Teklifi Kaydet</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Draft Requests Modal -->
    <div class="modal fade" id="draftRequestsModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-edit me-2"></i>
                        Taslak Talepler
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>Bilgi:</strong> Düzenlemek istediğiniz taslak talebi seçin. Seçilen talep mevcut sayfaya yüklenecektir.
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="draft-requests-table">
                            <thead class="table-light">
                                <tr>
                                    <th>Talep No</th>
                                    <th>Başlık</th>
                                    <th>Oluşturulma</th>
                                    <th>Malzeme Sayısı</th>
                                    <th>Tedarikçi Sayısı</th>
                                    <th>İşlemler</th>
                                </tr>
                            </thead>
                            <tbody id="draft-requests-tbody">
                                <!-- Draft requests will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="draft-requests-empty" style="display: none;">
                        <div class="text-center py-4">
                            <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">Taslak talep bulunamadı</h5>
                            <p class="text-muted">Henüz kaydedilmiş taslak talebiniz bulunmamaktadır.</p>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>

    <!-- SheetJS for Excel parsing -->
    <script src="https://cdn.sheetjs.com/xlsx-0.19.3/package/dist/xlsx.full.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="create.js"></script>
</body>
</html>
